<!DOCTYPE html>
<html>
<head>
<title>Private Theatre Booking</title>
<style>
body { font-family: Arial; padding:20px; }
label { font-weight:bold; }
input, select { padding:6px; margin:5px 0; width:100%; }
#summary, #paymentSection, #receiptSection { margin-top:20px; padding:15px; border:1px solid #ccc; }
.soldout { color:red; font-weight:bold; }
button { padding:10px 20px; margin-top:10px; }
</style>
</head>
<body>

<h2>Private Theatre Booking – Leela Gari Vididhillu</h2>

<!-- USER DETAILS -->
<label>Name</label>
<input type="text" id="name">

<label>Phone Number</label>
<input type="text" id="phone">

<label>Date</label>
<input type="date" id="date">

<!-- PACKAGE -->
<label>Choose Package</label>
<select id="package">
  <option value="">Select Package</option>
  <option value="1000" data-hours="1">One Hour – ₹1000</option>
  <option value="2500" data-hours="3">Three Hours – ₹2500</option>
  <option value="3500" data-hours="3">Premium Three Hours – ₹3500</option>
</select>

<!-- PEOPLE -->
<label>Number of People</label>
<input type="number" id="people" min="1">

<p><b>Extra Person Charges:</b> <span id="extraCharges">₹0</span></p>

<!-- TIME SLOT -->
<label>Start Time</label>
<select id="startTime"></select>

<label>End Time</label>
<input type="text" id="endTime" readonly>

<button onclick="calculateBooking()">Show Summary</button>

<!-- SUMMARY -->
<div id="summary" style="display:none;"></div>

<!-- PAYMENT -->
<div id="paymentSection" style="display:none;">
  <h3>Payment</h3>
  <p><b>Amount to Pay:</b> ₹<span id="payAmount"></span></p>
  
  <p>Pay using UPI:</p>
  <img id="upiQR" src="" width="200">

  <p><b>Transaction ID</b></p>
  <input type="text" id="txnId">

  <button onclick="generateReceipt()">Download Receipt</button>
</div>

<!-- RECEIPT -->
<div id="receiptSection" style="display:none;"></div>

<script>
// ---------------------------------
// STORED BOOKINGS (LOCAL STORAGE)
// ---------------------------------
let bookedSlots = JSON.parse(localStorage.getItem("bookedSlots") || "{}");

// ---------------------------------
// GENERATE TIME SLOTS
// ---------------------------------
function loadStartTimes() {
  let start = document.getElementById("startTime");
  start.innerHTML = "";

  let date = document.getElementById("date").value;
  if (!date) return;

  // create slots from 8am to 11pm
  let slots = [
    "08:00","09:00","10:00","11:00","12:00","13:00",
    "14:00","15:00","16:00","17:00","18:00","19:00",
    "20:00","21:00","22:00"
  ];

  slots.forEach(time => {
    let option = document.createElement("option");
    option.value = time;
    option.textContent = time;

    // check if booked
    if (bookedSlots[date] && bookedSlots[date].includes(time)) {
      option.disabled = true;
      option.textContent = time + " (SOLD OUT)";
    }

    start.appendChild(option);
  });
}

document.getElementById("date").addEventListener("change", loadStartTimes);

// ---------------------------------
// CALCULATE END TIME
// ---------------------------------
document.getElementById("startTime").addEventListener("change", function() {
  let pkg = document.getElementById("package");
  let hours = parseInt(pkg.options[pkg.selectedIndex].dataset.hours || 0);
  setEndTime(hours);
});

document.getElementById("package").addEventListener("change", function() {
  let start = document.getElementById("startTime").value;
  let hours = parseInt(this.options[this.selectedIndex].dataset.hours || 0);
  if(start) setEndTime(hours);
});

function setEndTime(hours) {
  let start = document.getElementById("startTime").value;
  if (!start || !hours) return;

  let [h, m] = start.split(":").map(Number);
  h += hours;

  if (h >= 24) h -= 24;

  document.getElementById("endTime").value = 
    (h < 10 ? "0" + h : h) + ":" + (m < 10 ? "0" + m : m);
}

// ---------------------------------
// CALCULATE BOOKING
// ---------------------------------
function calculateBooking() {

  let name = document.getElementById("name").value;
  let phone = document.getElementById("phone").value;
  let date = document.getElementById("date").value;
  let pkg = document.getElementById("package");
  let price = parseInt(pkg.value);
  let hours = pkg.options[pkg.selectedIndex].dataset.hours;
  let people = parseInt(document.getElementById("people").value);
  let start = document.getElementById("startTime").value;
  let end = document.getElementById("endTime").value;

  if (!name || !phone || !date || !pkg.value || !people || !start) {
    alert("Please fill all details");
    return;
  }

  let extra = 0;
  if (people > 15) extra = (people - 15) * 100;
  document.getElementById("extraCharges").innerText = "₹" + extra;

  let total = price + extra;

  // Store slot as booked in memory
  if (!bookedSlots[date]) bookedSlots[date] = [];
  bookedSlots[date].push(start);
  localStorage.setItem("bookedSlots", JSON.stringify(bookedSlots));

  let summary = `
    <h3>Booking Summary</h3>
    <p><b>Date:</b> ${date}</p>
    <p><b>Name:</b> ${name}</p>
    <p><b>Phone:</b> ${phone}</p>
    <p><b>Start Time:</b> ${start}</p>
    <p><b>End Time:</b> ${end}</p>
    <p><b>Package Price:</b> ₹${price}</p>
    <p><b>Extra Person Charges:</b> ₹${extra}</p>
    <p><b>Total:</b> ₹${total}</p>
  `;

  document.getElementById("summary").innerHTML = summary;
  document.getElementById("summary").style.display = "block";

  // Show payment
  document.getElementById("paymentSection").style.display = "block";
  document.getElementById("payAmount").innerText = total;

  // Auto-generate UPI QR
  let qr = 
`https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=upi://pay?pa=9052651447@naviaxis&pn=Theatre%20Booking&am=${total}`;
  
  document.getElementById("upiQR").src = qr;
}

// ---------------------------------
// GENERATE RECEIPT
// ---------------------------------
function generateReceipt() {
  let name = document.getElementById("name").value;
  let phone = document.getElementById("phone").value;
  let date = document.getElementById("date").value;
  let start = document.getElementById("startTime").value;
  let end = document.getElementById("endTime").value;
  let people = document.getElementById("people").value;
  let pkg = document.getElementById("package").value;
  let txn = document.getElementById("txnId").value;
  
  let extra = parseInt(document.getElementById("extraCharges").innerText.replace("₹",""));
  let total = parseInt(pkg) + extra;

  if (!txn) {
    alert("Please enter Transaction ID");
    return;
  }

  let text =
`THEATRE BOOKING RECEIPT
----------------------------
Name: ${name}
Phone: ${phone}
Date: ${date}
Start Time: ${start}
End Time: ${end}
People: ${people}
Package Amount: ₹${pkg}
Extra Charges: ₹${extra}
Total Paid: ₹${total}
Transaction ID: ${txn}
----------------------------
Thank you for booking!`;

  let blob = new Blob([text], { type: "text/plain" });
  let link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "theatre_receipt.txt";
  link.click();
}
</script>

</body>
</html>

